<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      lang="en"
      metal:use-macro="context/main_template/macros/master">

  <metal:content-core fill-slot="content-core">
    <metal:content-core define-macro="content-core">

      <tal:condition condition="not: view/available">
        <h3 tal:condition="not: view/available">Chef API must be first initilialized.</h3>
        <p>Update the
          <a href="#"
              tal:attributes="href string:${context/@@plone_portal_state/portal_url}/@@hosting-settings">
              Chef Settings
          </a>
        </p>
      </tal:condition>

      <tal:condition condition="view/available">

        <h3>Databags</h3>

        <table class="listing" summary="Databag List" id="databag-list">

          <thead>
            <tr>
              <th>Databag Name</th>
            </tr>
          </thead>

          <tbody>
            <tr tal:repeat="databag context/get_databags"
                tal:attributes="id databag/getId">
              <td>
                <a href="#"
                   tal:attributes="href databag/getId"
                   tal:content="databag/name">Databag name</a>
              </td>
            </tr>
          </tbody>

        </table>

        <div id="skel-contents">

          <tal:form define="form nocall:view/form">

            <!-- plone.app.z3cform package provides view ploneform-macros
                 which come with a helpers to render forms. This one
                 will render the form body only. It also makes an assumption
                 that form is presented in "view" TAL variable.

              -->
            <tal:with-form-as-view define="view nocall:form">
                <metal:block use-macro="form/@@ploneform-macros/titlelessform" />
            </tal:with-form-as-view>

          </tal:form>
        </div>
          
      </tal:condition>

    </metal:content-core>
  </metal:content-core>
</html>
